name: C/C++ CI

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]
  release:
    types: [published]

jobs:
  linux:
    name: 'Linux'
    runs-on: ubuntu-latest
    container: s1lentq/linux86buildtools:latest

    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          fetch-depth: 0

      - name: Build using Intel C++ Compiler 19.0
        run: |
          export LD_LIBRARY_PATH="third_party/linux32:$LD_LIBRARY_PATH"
          rm -rf build && CC=icc CXX=icpc cmake -B build && cmake --build build -j8
       
      - name: Deploy artifacts
        uses: actions/upload-artifact@v2
        with:
          name: linux32
          path: ./build/fsq_amxx_i386.so